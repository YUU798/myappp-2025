<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>å®¶è¨ˆç°¿ã‚¢ãƒ—ãƒª</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .section { margin-bottom: 20px; }
    input[type="number"] { width: 100px; }
    button { margin-left: 10px; }
  </style>
</head>
<body>

  <h1>ğŸ’° å®¶è¨ˆç°¿ã‚¢ãƒ—ãƒª</h1>

  <div class="section">
    <label>ç›®æ¨™é‡‘é¡: <input type="number" id="goalAmount" /></label>
    <button onclick="setGoal()">è¨­å®š</button>
  </div>

  <div class="section">
    <label>é‡‘é¡: <input type="number" id="amount" /></label>
    <button onclick="deposit()">å…¥é‡‘</button>
    <button onclick="withdraw()">å‡ºé‡‘</button>
  </div>

  <div class="section">
    <strong>ç¾åœ¨ã®æ®‹é«˜:</strong> <span id="balance">0</span> å††
    <br/>
    <strong>ç›®æ¨™é‡‘é¡:</strong> <span id="goalDisplay">0</span> å††
    <br/>
    <strong>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ã‚³ãƒ¡ãƒ³ãƒˆ:</strong> <span id="comment">æœªè¨­å®š</span>
  </div>

  <div class="section">
    <button onclick="showAnalysis()">åˆ†æã‚’è¦‹ã‚‹</button>
    <pre id="analysis"></pre>
  </div>

  <script src="code.js"></script>
  <script>
    // ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’åˆæœŸåŒ–
    const program = new ãƒ—ãƒ­ã‚°ãƒ©ãƒ ();
    const user = new åˆ©ç”¨è€…(program);

    function updateDisplay() {
      document.getElementById("balance").textContent = program.æ®‹é«˜.toFixed(2);
      document.getElementById("goalDisplay").textContent = program.ç›®æ¨™é‡‘é¡.toFixed(2);
    }

    function setGoal() {
      const value = parseFloat(document.getElementById("goalAmount").value);
      if (isNaN(value) || value < 0) {
        alert("ç›®æ¨™é‡‘é¡ã¯0ä»¥ä¸Šã®æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }
      program.ç›®æ¨™é‡‘é¡ = value;
      updateDisplay();
      program.ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼.ã‚³ãƒ¡ãƒ³ãƒˆã‚’å‡ºåŠ›(program.æ®‹é«˜, program.ç›®æ¨™é‡‘é¡);
    }

    function deposit() {
      const amount = parseFloat(document.getElementById("amount").value);
      user.ãƒ—ãƒ­ã‚°ãƒ©ãƒ .æ®‹é«˜ã‚’æ›´æ–°("å…¥é‡‘", amount);
      updateDisplay();
      showComment();
    }

    function withdraw() {
      const amount = parseFloat(document.getElementById("amount").value);
      user.ãƒ—ãƒ­ã‚°ãƒ©ãƒ .æ®‹é«˜ã‚’æ›´æ–°("å‡ºé‡‘", amount);
      updateDisplay();
      showComment();
    }

    function showComment() {
      const lastComment = program.ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼.æ°—åˆ† === "å¬‰ã—ã„"
        ? "ç´ æ™´ã‚‰ã—ã„ï¼ç›®æ¨™é”æˆã§ã™ï¼"
        : "é ‘å¼µã‚Šã©ã“ã‚ã§ã™ã€‚æ”¯å‡ºã‚’è¦‹ç›´ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚";
      document.getElementById("comment").textContent =
        `${program.ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼.æ°—åˆ†}ï¼š${lastComment}`;
    }

    function showAnalysis() {
      const analysisElement = document.getElementById("analysis");
      const data = program.å…¥å‡ºé‡‘ãƒ‡ãƒ¼ã‚¿.map(r => `- ${r.toString()}`).join("\n");
      const graph = (() => {
        const monthly = {};
        let currentBalance = 0;
        for (const record of program.å…¥å‡ºé‡‘ãƒ‡ãƒ¼ã‚¿) {
          const ym = `${record.æ—¥ä»˜.getFullYear()}-${(record.æ—¥ä»˜.getMonth() + 1).toString().padStart(2, '0')}`;
          if (record.ã‚¿ã‚¤ãƒ— === "å…¥é‡‘") currentBalance += record.é‡‘é¡;
          else currentBalance -= record.é‡‘é¡;
          monthly[ym] = currentBalance;
        }
        return Object.entries(monthly).map(([m, b]) => `${m}: ${b.toFixed(2)}å††`).join("\n");
      })();
      analysisElement.textContent = `--- æœˆæœ«æ®‹é«˜ ---\n${graph}\n\n--- å…¥å‡ºé‡‘å±¥æ­´ ---\n${data}`;
    }

    // åˆæœŸè¡¨ç¤º
    updateDisplay();
  </script>
</body>
</html>
